<!DOCTYPE html>
<html>
	<head>
        <link rel="stylesheet" href="https://pyscript.net/releases/2023.03.1/pyscript.css"/>
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
	<script type="text/javascript" src="webCode.js"></script>
	<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
	<link rel="stylesheet" type="text/css" href="style.css">
        <title>American Zip Code Visualizer</title>
	</head>
        <py-config>
		packages = ["matplotlib", "pandas", "folium", "seaborn", "plotly", "requests"] 
		terminal = false
        </py-config>
        <py-script src="https://raw.githubusercontent.com/Dravitar/LUISSDataVisProject/main/mapCode.py"></py-script>
        <py-script src="https://raw.githubusercontent.com/Dravitar/LUISSDataVisProject/main/webCode.py"></py-script>
        <py-script src="https://raw.githubusercontent.com/Dravitar/LUISSDataVisProject/main/Graphs%20ZIP%20CODES.py"></py-script>
	<header>
		<div class="title" id="title">SalesTaxExplorer</div>
		<button class="tab active" onclick="showSection('home')">Home</button>
		<button class="tab" onclick="showSection('search')">Zip Code Search</button>
		<button class="tab" onclick="showSection('state')">Select a State</button>
		<button class="tab" onclick="showSection('national')">National Statistics</button>
		<button class="tab" onclick="showSection('about')">About</button>
		<button class="tab" onclick="showSection('contact')">Contact</button>
	</header>
	<section id="home_section">
		<h1>Welcome to SalesTaxExplorer!</h1>
		<h2>This interactive website will allow you to look up sales tax information for any state in the US.<br>
			You can also search by zip code to see a detailed breakdown for that area.<br>
			Finally, we also have some graphs breaking down national trends and averages.</h2>
	</section>
	<section id="search_section", style="text-align: center; display: none;">
		<form>
			<label for="zip_code">Enter your zip code:</label>
			<input type="text" id="zip_code" name="zip_code">
			<label for="price">Enter the initial price of your item:</label>
			<input type="text" id="price" name="price">
			<button type="button" id="zipCodeSubmissionButton">Submit</button>
			<script>
				document.getElementById("zipCodeSubmissionButton").addEventListener("click", () => {
					price = document.getElementById("price").value;
					zip_code = document.getElementById("zip_code").value;
					const gZCG = pyscript.interpreter.globals.get('getZipCodeGraph');
					gZCG(zip_code, price);
				});
			</script>
		</form>
		<h3>Your total price would be $<span id="price_container">0.00</span> after state taxes.</h3>
		<div id="image_container"></div>
	</section>
	<section id="state_section" style="display:none">
		<div id="map-container" style="text-align: center; width:80%">
			<button type="button" id="show-map-button">Show US Map</button>
			<div id="usa-map" width="100%" style="display: none"></div>
			<script type='text/javascript'>
				function plot(graph, chart) {
					var figure = JSON.parse(graph)
					Plotly.newPlot(chart, figure, {});
				};
				document.getElementById("show-map-button").addEventListener("click", () => {
					if (document.getElementById("show-map-button").textContent == "Show US Map"){
						if (document.getElementById("usa-map").childNodes.length == 0) {
							const mapLoad = pyscript.interpreter.globals.get('startMap');
							mapLoad();
						}
						document.getElementById("show-map-button").textContent = "Hide US Map";
						document.getElementById("usa-map").style.display = "";
					}
					else {
						document.getElementById("show-map-button").textContent = "Show US Map";
						document.getElementById("usa-map").style.display = "none";
					}
				});
			</script>
		</div>
	</section>
	<section id="national_section" style="display:none">
		<button class="subtabbtn active" onclick="showSubtab('average_by_state')">State Averages</button>
		<button class="subtabbtn" onclick="showSubtab('high_and_low')">Highs and Lows</button>
		<button class="subtabbtn" onclick="showSubtab('national_pie')">National Breakdown</button>
		<button class="subtabbtn" onclick="showSubtab('national_outliers')">Outliers</button>		
		<subtab id="average_by_state_subtab">
			<img class="graph" src="ZDF pictures/Sales Tax Rates Avg.png">
			<div> This analysis gave rise to many insights.
				To begin with, we visualized the sales tax distribution among all the states involved.
				From this we can tell that all states - except for Alaska - have some form of state rate.
				Moreover, we can identify the 4 States that have no Sales Taxes at all: Montana, Oregon, New Hampshire, and Delaware.
			</div>
		</subtab>
		<subtab id="high_and_low_subtab" style="display: none" class="col">
			<div class="row">
				<img class="graph" src="ZDF pictures/Highest Total Sales Tax Rates.png">
				<div> To better visualize our data, we zoomed in on the states with the top 5 highest total taxes, and top 5 lowest total taxes.
					From this we can derive that the states with the highest taxes on average are mostly from the South (with exception to Puerto Rico).
				</div>
			</div>
			<div class="row">
				<img class="graph" src="ZDF pictures/Lowest Total Sales Tax Rates.png">
				<div> On the other hand, the states with the lowest taxes are mostly from the North (again, with the exception of Hawaii)
					(Please also note how this latter graph excludes the 5 states with no state taxes).
				</div>
			</div>
		</subtab>
		<subtab id="national_pie_subtab" style="display: none">
			<img class= "graph" src="ZDF pictures/Tax Rates by Type.png">
			<div> We also decided to visualize the data by taking an average of the US as a whole, and analyzing the distribution of sales taxes across the country.
				From here we were able to confirm that, on average, the vast majority of sales taxes goes towards the state, followed by the county and by the city.
				A quite small percentage goes instead to an additional rate.
			</div>
		</subtab>
		<subtab id="national_outliers_subtab" style="display: none">
			<img class= "graph" src="ZDF pictures/Boxplot.png">
			<div> The distribution can also be visualized in the form of box plots. Once again, we can identify the different value ranges each rate takes.
				The box plots are also very effective in identifying outliers. In particular:
				State Rate Outliers: Puerto Rico (upper outlier); Alaska, Delaware, New Hampshire, Oregon,  Montana (lower outliers)
				County Rate Outliers: New York, Georgia, Nevada
				City Rate Outliers: Oklahoma, Nevada, Colorado
				Additional Rate Outliers: California, Lousiana, South Carolina
			</div>
		</subtab>
	</section>
	<section id="about_section" style="display:none">
		<h2>About</h2>
		<p>Some information about the application.</p>
		<p>State Sales Tax data from <a href="https://api-ninjas.com/api/salestax">API Ninjas</a>.</p>
		<p>Other state information from <a href="https://data.opendatasoft.com/explore/dataset/georef-united-states-of-america-zc-point%40public/table/">opendatasoft</a>.</p>
	</section>
	<section id="contact_section" style="display:none">
		<h2>Contact</h2>
		<ul>
			<li><a href="mailto:nathan.henderson@studenti.luiss.it">Email</a></li>
			<li><a href="https://www.linkedin.com/in/alex-henderson-056943197/">LinkedIn</a></li>
		</ul>
	</section>
	<footer>
	</footer>        
    </body>
</html>
